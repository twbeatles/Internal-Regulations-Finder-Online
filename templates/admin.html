<!DOCTYPE html>
<html lang="ko" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="사내 규정 검색기 관리자 페이지">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline';">
    <title>관리자 - 사내 규정 검색기</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">⚙️</span>
                    <h1>관리자 페이지</h1>
                </div>
                <div class="header-info">
                    <button id="theme-toggle" class="theme-toggle" title="테마 변경">🌙</button>
                    <span id="status-badge" class="status-badge loading">
                        <span class="status-dot"></span>
                        <span id="status-text">연결 중...</span>
                    </span>
                    <a href="/" class="admin-link">🔍 검색</a>
                </div>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content admin-page">
            <!-- 시스템 메트릭 -->
            <section class="stats-section">
                <div class="metrics-grid">
                    <div class="metric-card cpu">
                        <span class="metric-icon">🖥️</span>
                        <span class="metric-value" id="stat-cpu">0%</span>
                        <span class="metric-label">CPU</span>
                    </div>
                    <div class="metric-card memory">
                        <span class="metric-icon">💾</span>
                        <span class="metric-value" id="stat-memory">0%</span>
                        <span class="metric-label">메모리</span>
                    </div>
                    <div class="metric-card users">
                        <span class="metric-icon">👥</span>
                        <span class="metric-value" id="stat-active">0</span>
                        <span class="metric-label">활성 검색</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📄</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-files">0</span>
                            <span class="stat-label">파일</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📊</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-chunks">0</span>
                            <span class="stat-label">청크</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💾</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-size">0 B</span>
                            <span class="stat-label">용량</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🤖</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-model">-</span>
                            <span class="stat-label">모델</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI 모델 설정 섹션 -->
            <section class="model-section card admin-only" style="display: none;">
                <h2 class="section-title">🤖 AI 모델 설정</h2>
                <div class="model-settings">
                    <div class="form-group">
                        <label for="model-select">사용할 AI 모델</label>
                        <select id="model-select" class="form-select">
                            <option value="" disabled selected>모델 불러오는 중...</option>
                        </select>
                        <p class="form-hint" style="margin-top: 8px; color: var(--text-secondary); font-size: 0.9em;">
                            ⚠️ 모델 변경 시 서버가 잠시 멈추며, 메모리 사용량이 변할 수 있습니다.
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 15px;">
                        <button id="change-model-btn" class="btn btn-primary">변경 적용</button>
                    </div>
                </div>
            </section>

            <!-- 파일 업로드 섹션 -->
            <section class="upload-section card admin-only" style="display: none;">
                <h2 class="section-title">📁 규정 파일 업로드</h2>
                <div class="upload-options" style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button id="btn-upload-file" class="btn btn-primary active">파일 업로드</button>
                    <button id="btn-upload-folder" class="btn btn-secondary">폴더 업로드 (ZIP)</button>
                </div>

                <!-- 파일 업로드 (기본) -->
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <div class="upload-icon">📤</div>
                        <p class="upload-text">파일을 드래그하거나 클릭하여 업로드</p>
                        <p class="upload-hint">지원 형식: .txt, .docx, .pdf, .xlsx, .hwp (최대 50MB)</p>
                    </div>
                    <input type="file" id="file-input" multiple accept=".txt,.docx,.pdf,.xlsx,.xls,.hwp" hidden
                        aria-label="파일 선택">
                </div>

                <!-- 폴더 업로드 (ZIP) -->
                <div class="upload-area" id="folder-upload-area" style="display: none;">
                    <div class="upload-content">
                        <div class="upload-icon">🗂️</div>
                        <p class="upload-text">ZIP 파일을 드래그하거나 클릭하여 업로드</p>
                        <p class="upload-hint">폴더 구조가 포함된 ZIP 파일을 업로드하세요</p>
                    </div>
                    <input type="file" id="folder-input" accept=".zip" hidden aria-label="ZIP 파일 선택">
                </div>

                <div id="upload-progress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p class="progress-text" id="progress-text">업로드 중...</p>
                </div>
            </section>

            <!-- 동기화 설정 섹션 (v2.0) -->
            <section class="sync-section card admin-only" style="display: none;">
                <h2 class="section-title">🔄 자동 동기화 설정</h2>
                <div class="sync-controls">
                    <p class="sync-desc">지정된 폴더의 변경사항(파일 추가/수정/삭제)을 실시간으로 감지하여 자동으로 반영합니다.</p>
                    <div class="sync-status-box">
                        <span id="sync-status-indicator" class="status-dot"></span>
                        <span id="sync-status-text">동기화 중지됨</span>
                    </div>
                    <div class="sync-actions">
                        <input type="text" id="sync-folder-path" class="form-input"
                            placeholder="모니터링할 폴더 경로 (기본값: upload 폴더)" readonly>
                        <button id="btn-start-sync" class="btn btn-success">▶ 시작</button>
                        <button id="btn-stop-sync" class="btn btn-danger" disabled>⏹ 중지</button>
                    </div>
                </div>
            </section>

            <!-- 파일 목록 섹션 -->
            <section class="files-section card admin-only" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">📋 로드된 파일 목록</h2>
                    <div class="section-actions">
                        <button id="refresh-btn" class="btn btn-secondary">
                            🔄 새로고침
                        </button>
                        <button id="reprocess-btn" class="btn btn-secondary">
                            ⚡ 재처리
                        </button>
                        <button id="clear-cache-btn" class="btn btn-warning">
                            🗑️ 캐시 삭제
                        </button>
                        <button id="delete-all-btn" class="btn btn-danger" title="모든 로드된 파일 및 인덱스 삭제">
                            ⚠️ 전체 삭제
                        </button>
                    </div>
                </div>
                <div class="files-table-container">
                    <table class="files-table" id="files-table">
                        <thead>
                            <tr>
                                <th>상태</th>
                                <th>파일명</th>
                                <th>크기</th>
                                <th>청크</th>
                                <th>버전</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="files-tbody">
                            <tr class="empty-row">
                                <td colspan="6">로드된 파일이 없습니다</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 서버 정보 -->
            <section class="info-section card">
                <h2 class="section-title">ℹ️ 서버 정보</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">API 상태</span>
                        <code>/api/status</code>
                    </div>
                    <div class="info-item">
                        <span class="info-label">검색 API</span>
                        <code>POST /api/search</code>
                    </div>
                    <div class="info-item">
                        <span class="info-label">업로드 API</span>
                        <code>POST /api/upload</code>
                    </div>
                    <div class="info-item">
                        <span class="info-label">파일 목록</span>
                        <code>/api/files</code>
                    </div>
                    <div class="info-item">
                        <span class="info-label">버전 비교 API</span>
                        <code>GET /api/files/{filename}/versions/compare</code>
                    </div>
                </div>
            </section>
        </main>

        <!-- 푸터 -->
        <footer class="footer">
            <p>© <span id="current-year">2025</span> 사내 규정 검색기 - 관리자 페이지</p>
        </footer>
    </div>

    <!-- 비밀번호 인증 모달 -->
    <div id="auth-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h3>🔒 관리자 인증</h3>
            </div>
            <div class="modal-body">
                <p>관리자 페이지에 접근하려면 비밀번호를 입력하세요.</p>
                <input type="password" id="auth-password" class="auth-input" placeholder="비밀번호 입력" autofocus>
                <p id="auth-error" class="auth-error" style="display: none;"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="location.href='/'">취소</button>
                <button class="btn btn-primary" onclick="submitAdminAuth()">확인</button>
            </div>
        </div>
    </div>

    <!-- 버전 비교 모달 -->
    <div id="version-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content version-modal">
            <div class="modal-header">
                <h3>📋 버전 비교</h3>
                <button id="version-modal-close" class="modal-close" onclick="VersionManager.close()">✕</button>
            </div>
            <div class="version-selector">
                <div class="version-select-group">
                    <label for="version-left">이전 버전</label>
                    <select id="version-left" class="form-select"></select>
                </div>
                <span class="version-compare-icon">⇔</span>
                <div class="version-select-group">
                    <label for="version-right">비교 버전</label>
                    <select id="version-right" class="form-select"></select>
                </div>
                <button id="version-compare-btn" class="btn btn-primary" onclick="VersionManager.compare()">비교</button>
            </div>
            <div id="version-diff-container" class="version-diff-container">
                <div class="version-diff-stats">
                    <span id="diff-added" class="diff-stat added">+0 추가</span>
                    <span id="diff-removed" class="diff-stat removed">-0 삭제</span>
                    <span id="diff-similarity">유사도: --%</span>
                </div>
                <div id="version-diff-content" class="version-diff-content">
                    <p class="empty-state">버전을 선택하고 '비교' 버튼을 클릭하세요</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 토스트 알림 -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/static/app.js"></script>
    <script>
        // 관리자 페이지 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initAdmin();
        });

        // 비밀번호 입력 시 엔터 키 처리
        document.getElementById('auth-password')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitAdminAuth();
            }
        });
    </script>
</body>

</html>