<!DOCTYPE html>
<html lang="ko" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="사내 규정 검색기 - AI 기반 하이브리드 검색 시스템">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;">

    <!-- PWA 지원 (v2.0) -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="규정검색">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

    <title>사내 규정 검색기</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- 스킵 네비게이션 (접근성) -->
    <a href="#search-input" class="skip-link">검색으로 건너뛰기</a>

    <div class="app-container">
        <!-- 헤더 -->
        <header class="header" role="banner">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon" aria-hidden="true">📚</span>
                    <h1>사내 규정 검색기</h1>
                </div>
                <div class="header-info">
                    <button id="bookmark-toggle" class="header-btn" title="북마크 목록" aria-label="북마크 목록 열기">📌</button>
                    <button id="theme-toggle" class="theme-toggle" title="테마 변경" aria-label="다크/라이트 테마 전환">🌙</button>
                    <span id="status-badge" class="status-badge loading" role="status" aria-live="polite">
                        <span class="status-dot" aria-hidden="true"></span>
                        <span id="status-text">연결 중...</span>
                    </span>
                    <a href="/admin" class="admin-link" aria-label="관리자 페이지로 이동">⚙️ 관리</a>
                </div>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content" role="main" id="main-content">
            <!-- 검색 섹션 -->
            <section class="search-section" aria-labelledby="search-title">
                <h2 id="search-title" class="sr-only">규정 검색</h2>
                <div class="search-container">
                    <div class="search-box" role="search">
                        <input type="search" id="search-input" placeholder="검색어를 입력하세요... (예: 휴가 규정, 복리후생)"
                            autocomplete="off" minlength="2" maxlength="200" aria-label="규정 검색어 입력"
                            aria-describedby="search-hint" spellcheck="false">
                        <span id="search-hint" class="sr-only">최소 2자 이상 입력하세요. Ctrl+K로 언제든 검색창에 포커스할 수 있습니다.</span>
                        <button id="search-btn" class="search-btn" disabled aria-label="검색 실행">
                            <span class="btn-icon" aria-hidden="true">🔍</span>
                            <span class="btn-text">검색</span>
                        </button>
                    </div>
                    <div class="search-options">
                        <label class="option-item">
                            <span>결과 개수:</span>
                            <select id="result-count">
                                <option value="5" selected>5개</option>
                                <option value="10">10개</option>
                                <option value="20">20개</option>
                            </select>
                        </label>
                        <label class="option-item">
                            <span>파일 필터:</span>
                            <select id="filter-file">
                                <option value="">전체 파일</option>
                            </select>
                        </label>
                        <label class="option-item">
                            <span>정렬:</span>
                            <select id="sort-by">
                                <option value="relevance">관련도순</option>
                                <option value="filename">파일명순</option>
                                <option value="length">길이순</option>
                            </select>
                        </label>
                        <label class="option-item checkbox">
                            <input type="checkbox" id="hybrid-search" checked>
                            <span>하이브리드 검색</span>
                        </label>
                        <button id="advanced-search-toggle" class="btn btn-sm btn-secondary" type="button"
                            title="고급 검색 옵션">
                            🔧 고급 검색
                        </button>
                    </div>
                    <!-- 고급 검색 패널 -->
                    <div id="advanced-search-panel" class="advanced-search-panel" style="display: none;">
                        <div class="advanced-search-header">
                            <span>🔍 고급 검색 옵션</span>
                            <button id="advanced-search-close" class="btn-icon" type="button">✕</button>
                        </div>
                        <div class="advanced-search-body">
                            <div class="advanced-option">
                                <label>검색 연산자 사용:</label>
                                <div class="operator-help">
                                    <code>AND</code> 두 키워드 모두 포함 (예: 휴가 AND 연차)
                                    <code>OR</code> 하나라도 포함 (예: 휴가 OR 연차)
                                    <code>NOT</code> 제외 검색 (예: 휴가 NOT 병가)
                                    <code>"..."</code> 정확한 문구 (예: "연차 휴가")
                                </div>
                            </div>
                            <div class="advanced-option">
                                <label class="option-item checkbox">
                                    <input type="checkbox" id="use-regex">
                                    <span>정규식 검색 사용</span>
                                </label>
                            </div>
                            <div class="advanced-option">
                                <label for="date-from">날짜 범위:</label>
                                <div class="date-range">
                                    <input type="date" id="date-from" placeholder="시작일">
                                    <span>~</span>
                                    <input type="date" id="date-to" placeholder="종료일">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 결과 섹션 -->
            <section class="results-section" aria-labelledby="results-title">
                <h2 id="results-title" class="sr-only">검색 결과</h2>
                <div id="results-container" class="results-container" role="region" aria-live="polite"
                    aria-atomic="false">
                    <div class="welcome-message">
                        <div class="welcome-icon" aria-hidden="true">👋</div>
                        <h2>사내 규정을 검색해보세요</h2>
                        <p>휴가, 복리후생, 근무 규정 등 다양한 사내 규정을 빠르게 찾아볼 수 있습니다.</p>

                        <!-- 검색 팁 카드 -->
                        <div class="search-tips-card">
                            <p class="tips-title">💡 검색 팁</p>
                            <ul class="tips-list">
                                <li><kbd>Ctrl + K</kbd> 검색창 바로가기</li>
                                <li><kbd>?</kbd> 단축키 도움말</li>
                                <li>하이브리드 검색으로 더 정확한 결과 제공</li>
                            </ul>
                        </div>

                        <!-- 문서 미로드 시 표시될 안내 (JS에서 동적으로 표시) -->
                        <div id="no-documents-notice" class="no-documents-state empty-state-container"
                            style="display: none;">
                            <div class="empty-state-icon">📁</div>
                            <h3 class="empty-state-title">문서가 로드되지 않았습니다</h3>
                            <p class="empty-state-description">
                                검색을 시작하려면 먼저 관리자 페이지에서 문서 폴더를 설정해주세요.
                            </p>
                            <div class="empty-state-actions">
                                <a href="/admin" class="btn btn-primary">
                                    ⚙️ 관리자 페이지에서 설정하기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 푸터 -->
        <footer class="footer" role="contentinfo">
            <p>© <span id="current-year">2026</span> 사내 규정 검색기 - AI 기반 규정 검색 시스템 v2.3</p>
        </footer>
    </div>

    <!-- 토스트 알림 -->
    <div id="toast-container" class="toast-container"></div>

    <!-- 읽기 모드 모달 (v2.0) -->
    <div id="reader-modal" class="modal-overlay" style="display: none;">
        <div class="reader-content">
            <div class="reader-toolbar">
                <button id="reader-close" class="reader-btn" title="닫기 (Esc)">✕</button>
                <div class="reader-title" id="reader-title">문서 읽기</div>
                <div class="reader-controls">
                    <button id="reader-font-down" class="reader-btn" title="글자 작게">A-</button>
                    <span id="reader-font-size">16px</span>
                    <button id="reader-font-up" class="reader-btn" title="글자 크게">A+</button>
                </div>
            </div>
            <div id="reader-body" class="reader-body"></div>
        </div>
    </div>

    <!-- 키보드 단축키 도움말 모달 (v2.0) -->
    <div id="shortcuts-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content shortcuts-modal">
            <div class="modal-header">
                <h3>⌨️ 키보드 단축키</h3>
                <button id="shortcuts-close" class="modal-close">✕</button>
            </div>
            <div class="shortcuts-list">
                <div class="shortcut-group">
                    <h4>검색</h4>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>K</kbd>
                        <span>검색창 포커스</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Enter</kbd>
                        <span>검색 실행</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span>모달 닫기</span>
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>탐색</h4>
                    <div class="shortcut-item">
                        <kbd>J</kbd> / <kbd>↓</kbd>
                        <span>다음 결과</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>K</kbd> / <kbd>↑</kbd>
                        <span>이전 결과</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Enter</kbd>
                        <span>선택한 결과 열기</span>
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>하이라이트</h4>
                    <div class="shortcut-item">
                        <kbd>N</kbd>
                        <span>다음 하이라이트</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>P</kbd>
                        <span>이전 하이라이트</span>
                    </div>
                </div>
                <div class="shortcut-group">
                    <h4>기타</h4>
                    <div class="shortcut-item">
                        <kbd>?</kbd>
                        <span>단축키 도움말</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>R</kbd>
                        <span>읽기 모드</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>T</kbd>
                        <span>테마 변경</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 하이라이트 네비게이션 바 (v2.0) -->
    <div id="highlight-nav" class="highlight-nav" style="display: none;">
        <span id="highlight-count">0 / 0</span>
        <button id="highlight-prev" class="highlight-btn" title="이전 하이라이트 (P)">◀</button>
        <button id="highlight-next" class="highlight-btn" title="다음 하이라이트 (N)">▶</button>
        <button id="highlight-close" class="highlight-btn" title="닫기">✕</button>
    </div>

    <!-- 북마크 사이드 패널 -->
    <div id="bookmark-panel" class="bookmark-panel">
        <div class="bookmark-panel-header">
            <h3>📌 북마크 목록</h3>
            <button id="bookmark-panel-close" class="btn-icon" aria-label="닫기">✕</button>
        </div>
        <div class="bookmark-panel-actions">
            <input type="search" id="bookmark-search" placeholder="북마크 검색..." class="bookmark-search-input">
            <select id="bookmark-filter" class="bookmark-filter-select">
                <option value="all">전체</option>
                <option value="recent">최근 추가</option>
            </select>
        </div>
        <div id="bookmark-list" class="bookmark-list">
            <!-- 북마크 아이템이 여기에 동적으로 추가됨 -->
        </div>
        <div class="bookmark-panel-footer">
            <span id="bookmark-count">0개 저장됨</span>
            <button id="bookmark-export-btn" class="btn btn-sm btn-secondary">📥 내보내기</button>
            <button id="bookmark-clear-btn" class="btn btn-sm btn-danger">🗑️ 전체 삭제</button>
        </div>
    </div>
    <div id="bookmark-overlay" class="bookmark-overlay"></div>

    <!-- 버전 비교 모달 -->
    <div id="version-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content version-modal">
            <div class="modal-header">
                <h3>📋 버전 비교</h3>
                <button id="version-modal-close" class="modal-close">✕</button>
            </div>
            <div class="version-selector">
                <div class="version-select-group">
                    <label for="version-left">이전 버전</label>
                    <select id="version-left" class="form-select"></select>
                </div>
                <span class="version-compare-icon">⇔</span>
                <div class="version-select-group">
                    <label for="version-right">비교 버전</label>
                    <select id="version-right" class="form-select"></select>
                </div>
                <button id="version-compare-btn" class="btn btn-primary">비교</button>
            </div>
            <div id="version-diff-container" class="version-diff-container">
                <div class="version-diff-stats">
                    <span id="diff-added" class="diff-stat added">+0 추가</span>
                    <span id="diff-removed" class="diff-stat removed">-0 삭제</span>
                    <span id="diff-similarity">유사도: --%</span>
                </div>
                <div id="version-diff-content" class="version-diff-content">
                    <p class="empty-state">버전을 선택하고 '비교' 버튼을 클릭하세요</p>
                </div>
            </div>
        </div>
    </div>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <script src="/static/app.js"></script>
</body>

</html>